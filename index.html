<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chicken Cross the Road</title>
  <style>
    body {
      background: #e0f7fa;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: Arial, sans-serif;
      margin: 0;
      height: 100vh;
    }
    h1 {
      margin-top: 20px;
      margin-bottom: 10px;
    }
    #score {
      font-size: 1.2em;
      margin-bottom: 10px;
    }
    #gameArea {
      position: relative;
      width: 400px;
      height: 600px;
      background: #a5d6a7;
      border: 4px solid #333;
      overflow: hidden;
      box-shadow: 0 4px 16px #888;
    }
    .lane {
      position: absolute;
      left: 0;
      width: 100%;
      height: 50px;
      background: #fffde7;
      border-bottom: 2px dashed #bbb;
      z-index: 1;
    }
    .rest {
      position: absolute;
      left: 0;
      width: 100%;
      height: 50px;
      background: #ffe082;
      border-bottom: 2px solid #bbb;
      z-index: 0;
    }
    .car {
      position: absolute;
      top: 10px;
      font-size: 2em;
    }
    #chicken {
      position: absolute;
      left: 180px;
      font-size: 2em;
      transition: top 0.1s, left 0.1s;
      z-index: 2;
    }
  </style>
</head>
<body>
  <h1>üêî Chicken Cross the Road</h1>
  <div id="score">Score: 0</div>
  <div id="gameArea"></div>
  <script>
    const gameArea = document.getElementById('gameArea');
    const scoreDiv = document.getElementById('score');
    const areaWidth = 400;
    const areaHeight = 600;
    const laneHeight = 50;
    const totalLanes = 10; // More lanes for more roads
    const restEvery = 3; // Insert a rest area after every 3 roads
    let pattern = [];
    let cars = [];
    let carSpeeds = [];
    let carDirections = [];
    let score = 0;
    let bestScore = 0;
    let chicken = { x: 180, y: areaHeight - laneHeight, size: 40 };
    let gameRunning = true;

    function randomPattern() {
      // Generate a pattern: 1 = road, 0 = rest
      let arr = [];
      let i = 0;
      while (i < totalLanes) {
        for (let r = 0; r < restEvery && i < totalLanes; r++, i++) arr.push(1);
        if (i < totalLanes) { arr.push(0); i++; }
      }
      // Always make bottom and top rest areas
      arr[0] = 0;
      arr[arr.length - 1] = 0;
      return arr;
    }

    function randomizeCars() {
      carSpeeds = [];
      carDirections = [];
      for (let i = 0; i < totalLanes; i++) {
        carSpeeds.push(1 + Math.random() * 2.2); // 1.0 to 3.2
        carDirections.push(Math.random() > 0.5 ? 1 : -1);
      }
    }

    function drawPattern() {
      // Clear game area
      gameArea.innerHTML = '';
      // Draw pattern
      for (let i = 0; i < totalLanes; i++) {
        const div = document.createElement('div');
        div.className = pattern[i] === 0 ? 'rest' : 'lane';
        div.style.top = (i * laneHeight) + 'px';
        gameArea.appendChild(div);
      }
    }

    function spawnCars() {
      // Remove old cars
      for (let car of cars) {
        if (car.div.parentNode) car.div.parentNode.removeChild(car.div);
      }
      cars = [];
      for (let i = 0; i < totalLanes; i++) {
        if (pattern[i] === 1) { // Only on road lanes
          const car = document.createElement('div');
          car.className = 'car';
          car.innerText = Math.random() > 0.5 ? 'üöó' : 'üöô';
          let left = carDirections[i] === 1 ? -60 : areaWidth + 20;
          car.style.left = left + 'px';
          car.style.top = (i * laneHeight + 10) + 'px';
          gameArea.appendChild(car);
          cars.push({
            div: car,
            lane: i,
            x: left,
            speed: carSpeeds[i],
            dir: carDirections[i]
          });
        }
      }
    }

    function resetChicken() {
      chicken.x = 180;
      chicken.y = areaHeight - laneHeight;
      updateChicken();
    }

    function updateChicken() {
      chickenDiv.style.left = chicken.x + 'px';
      chickenDiv.style.top = chicken.y + 'px';
    }

    function updateScore() {
      scoreDiv.innerText = `Score: ${score}  |  Best: ${bestScore}`;
    }

    function moveCars() {
      for (let car of cars) {
        car.x += car.speed * car.dir;
        if (car.dir === 1 && car.x > areaWidth + 20) {
          car.x = -60;
        } else if (car.dir === -1 && car.x < -60) {
          car.x = areaWidth + 20;
        }
        car.div.style.left = car.x + 'px';
      }
    }

    function checkCollision() {
      for (let car of cars) {
        let carY = car.lane * laneHeight;
        if (
          chicken.y < carY + laneHeight - 10 &&
          chicken.y + chicken.size > carY + 10 &&
          chicken.x + chicken.size > car.x &&
          chicken.x < car.x + 40
        ) {
          return true;
        }
      }
      return false;
    }

    function gameLoop() {
      if (!gameRunning) return;
      moveCars();
      if (checkCollision()) {
        if (score > bestScore) bestScore = score;
        score = 0;
        updateScore();
        resetChicken();
      }
      // Check if crossed all lanes (reached top rest area)
      if (chicken.y < laneHeight) {
        pattern = randomPattern();
        randomizeCars();
        drawPattern();
        spawnCars();
        resetChicken();
      }
      requestAnimationFrame(gameLoop);
    }

    // Add chicken
    const chickenDiv = document.createElement('div');
    chickenDiv.id = 'chicken';
    chickenDiv.innerText = 'üêî';
    gameArea.appendChild(chickenDiv);

    document.addEventListener('keydown', (e) => {
      if (!gameRunning) return;
      if (e.key === 'ArrowUp') {
        if (chicken.y - laneHeight >= 0) {
          chicken.y -= laneHeight;
          score++;
          updateScore();
        }
      } else if (e.key === 'ArrowDown') {
        if (chicken.y + laneHeight < areaHeight) {
          chicken.y += laneHeight;
          score++;
          updateScore();
        }
      } else if (e.key === 'ArrowLeft') {
        if (chicken.x - 20 >= 0) chicken.x -= 20;
      } else if (e.key === 'ArrowRight') {
        if (chicken.x + 20 <= areaWidth - chicken.size) chicken.x += 20;
      }
      updateChicken();
    });

    // Initial setup
    pattern = randomPattern();
    randomizeCars();
    drawPattern();
    spawnCars();
    updateScore();
    updateChicken();
    gameLoop();
  </script>
</body>
</html>
